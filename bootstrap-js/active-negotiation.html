<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <link rel="tokenscript" href="EntryToken.xml"/>
    <link rel="tokenscript" href="BOOKY.xml"/>
    <!-- since we are demonstrating active negotiation here, there is no meta-data declared in this example
     -->

    <title>Showing the cards in a web page</title>
    <link rel="stylesheet" href="ts.css">
    <script type="text/javascript" src="web3.min.js"></script>
    <script type="text/javascript" src="ethers-5.0.umd.min.js"></script>
    <script type="text/javascript" src="tokenscript-bootstrap.js"></script>
    <script type="text/javascript">
        // the following event is triggered every time when a token is negotiated
        // and that is why an event listener is used in place of a promise;


        // OG: parse XML, load external files etc (but dont parse token-specific data) + code blocked until all files fetched completely
        // const tokenCard = new TokenCard();
        window.addEventListener("ontokennegotiation", async (e) => {
            console.log('ontokennegotiation data received: ' + e.detail);
        });

        // note that without the user clicking the button "new_token", the TokenBar won't appear at all.
        // since the TokenScript engine don't even know if this website can use any token.
        // but when the user clicks that button, the Negotiator at work will pop up a dialogue for the user to choose
        // a token (the dialogue is simply a TokenBar opened with the rest of the screen darkened).
        // (After the user made the choice, we are unsure if the TokenBar should disappear or just hang out there like
        // a float button. My (Weiwu) thinking is that the token bar should be floating there if there are listeners
        // and not float there if the negotiation is handled with a promise. But we can figure this out later as well.

        function negotiate() {
            // Negotiator.negotiate() returns a promise, but in this case
            // the developer doesn't need to save it or call .then()
            // because a window.ontokennegotiation is triggered.
            // the developer will want to save it or call .then() if they
            // have things to do specifically for this round of negotiation

            // OG: I think we can use TokenCard method to re-render iframe, because some logic makes network requests and parse XML (it takes some time and load network). So TokenCard constructor will parse XML and load external data and negotiate() method will rerender iframe
            console.log('Btn clicked');
            // Negotiator.negotiate('entrytoken', 'l=Syndey');
            Negotiator.selectTokenFromList('l=Syndey');

            document.getElementById("enter_button").onclick = (event) => {
                console.log('click fired');
                /*
                token.enterAction().then(e=>{

                    }
                    // â€¦ code to handle the result of enter action.
                )
                 */
            };
        }

    </script>
</head>
<body>
<h1>Demonstration of showing a card in a web page</h1>
<h2>Token Card</h2>
<div id="card_container"></div>
<p><button id="enter_button">Enter</button></p>
<p><button id="new_token" onclick="negotiate()">
    Click here to start choosing a token</button></p>
</body>
</html>
